# 鸿蒙工作流用户指导文档

## 快速开始

### 环境要求
- Python 3.10+
- 有效的API密钥（DeepSeek、Anthropic、OpenAI等）
- HarmonyOS开发环境（可选，用于本地编译验证）

### 安装配置
1. **克隆项目**
```bash
git clone https://github.com/Tiamstar/DeepSearcher.git
cd DeepSearcher
```

2. **安装依赖**
```bash
uv sync --extra all --group dev
```

3. **配置环境变量**
```bash
cp .env.example .env
# 编辑.env文件，添加所需的API密钥
```

## 主要功能

### 工作流一：初始代码生成工作流

这是核心的鸿蒙代码生成流程，包含6个自动化步骤：

#### 使用方式

**交互模式（推荐）**
```bash
python mcp_main.py --mode interactive
```
启动后输入你的需求，例如：
- "创建一个鸿蒙图片浏览器界面"
- "开发一个带轮播功能的相册应用"
- "实现图片预览和缩放功能"

**单次请求模式**
```bash
python mcp_main.py --mode single --query "创建一个鸿蒙图片浏览器"
```

**API模式**
```bash
python mcp_main.py --mode api --host 0.0.0.0 --port 8000
```
然后通过HTTP请求调用：
```bash
curl -X POST http://localhost:8000/harmonyos/generate \
  -H "Content-Type: application/json" \
  -d '{"query": "创建一个鸿蒙图片浏览器"}'
```

#### 工作流步骤详解

1. **需求分析** 
   - 自动读取 `/MyApplication2/README.md` 中的项目描述
   - AI分析你的需求并提取关键技术点
   - 确定需要搜索的技术资料类型

2. **信息搜索**
   - 基于需求自动搜索鸿蒙开发相关资料
   - 获取ArkTS语法、组件使用方法等信息
   - 为代码生成提供技术支撑

3. **代码生成**
   - 使用DeepSeek推理模型生成高质量代码
   - 直接在 `MyApplication2/entry/src/main/ets/pages/Index.ets` 中写入代码
   - 自动适配鸿蒙开发规范

4. **静态检查**
   - 使用codelinter进行代码质量检查
   - 检测语法错误、规范问题
   - 如发现问题自动触发错误修复流程

5. **编译检查**
   - 使用hvigorw进行项目编译
   - 验证代码是否能正确构建
   - 检测编译时错误

6. **完成/修复**
   - 成功则输出最终结果
   - 失败则自动进入错误修复工作流

### 工作流二：错误修复工作流

当静态检查或编译检查发现问题时自动触发：

1. **错误收集** - 收集所有错误信息和原始代码
2. **问题分析** - AI分析错误原因并确定搜索方向  
3. **解决方案搜索** - 搜索相关的修复方法和最佳实践
4. **代码修复** - 基于错误信息和搜索结果进行智能修复

## 配置说明

### LLM模型配置

系统支持多种LLM提供商，在 `config/config.yaml` 中配置：

**当前推荐配置：**
- **项目管理Agent**: DeepSeek-Reasoner（用于需求分析和规划）
- **代码生成Agent**: Claude-3.5-Haiku（用于代码生成）
- **最终生成Agent**: DeepSeek-Reasoner（用于代码优化）

### 自定义配置

你可以根据需要修改配置：

1. **切换LLM提供商** - 在config.yaml中注释/解注释不同的provider
2. **调整超时设置** - 修改各步骤的timeout参数
3. **修改循环参数** - 调整max_iterations控制修复尝试次数

## 输出说明

### 文件位置
生成的代码将直接写入：
```
MyApplication2/entry/src/main/ets/pages/Index.ets
```

### 输出内容
- 完整的鸿蒙ArkTS页面代码
- 符合鸿蒙开发规范
- 包含用户需求的所有功能
- 经过静态检查和编译验证

### 日志查看
```bash
# 查看详细执行日志
tail -f logs/mcp_system.log

# 查看简化输出
tail -f logs.txt
```

## 常见问题

### Q: 代码生成失败怎么办？
A: 系统会自动尝试修复，最多循环3次。如果仍然失败，请检查：
- API密钥是否正确配置
- 网络连接是否正常
- 需求描述是否清晰

### Q: 如何自定义项目需求？
A: 编辑 `MyApplication2/README.md` 文件，详细描述你想要的功能特性。

### Q: 支持哪些鸿蒙功能？
A: 支持所有ArkTS标准组件和API，包括：
- UI组件（Button、Image、Text等）
- 布局组件（Flex、Stack、Grid等）
- 交互功能（手势、动画、事件）
- 自定义组件开发

### Q: 如何验证生成的代码？
A: 系统会自动进行静态检查和编译验证。你也可以手动运行：
```bash
cd MyApplication2
# 静态检查
codelinter

# 编译检查  
hvigorw --mode project -p product=default assembleApp
```

## 最佳实践

1. **需求描述** - 尽量详细描述功能需求，包含具体的交互逻辑
2. **项目配置** - 确保README.md中包含完整的项目描述
3. **API配额** - 注意API使用限制，避免频繁调用
4. **结果验证** - 建议在实际设备或模拟器中测试生成的代码

## 技术支持

- 查看技术文档了解系统架构
- 检查日志文件排查问题
- 提交Issue报告Bug或建议改进
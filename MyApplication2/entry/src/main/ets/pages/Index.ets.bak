import { ImagePreview, ImagePreviewConfig, ImagePreviewSwiper } from '@rv/image-preview'

@ComponentV2
struct Index {
  @Local imageList: string[] = [
    'https://example.com/image1.jpg',
    'https://example.com/image2.jpg',
    'https://example.com/image3.jpg'
  ]
  private config: ImagePreviewConfig = new ImagePreviewConfig()
    .setIndicatorCount(3)
    .setMaxScale(3)
    .setMinScale(0.5)
    .setDoubleClickDefaultScale(3)
    .setInitialIndex(1)
    .setOnScrollIndex((index: number) => {
      promptAction.showToast({ message: `当前图片索引：${index}` })
    })
    .setOnClick((index: number) => {
      promptAction.showToast({ message: `父组件点击：图片${index}` })
    })
    .setOnLongPress((index: number) => {
      promptAction.showToast({ message: `长按事件：图片${index}` })
    })

  @Builder imageChild(data: Index) {
    ForEach(data.imageList, (item: string) => {
      ImagePreview({
        config: new ImagePreviewConfig().setOnClick(() => {})
      }) {
        Image(item)
          .fitOriginalSize(true)
      }
    })
  }

  build() {
    Column() {
      Flex({ justifyContent: FlexAlign.SpaceBetween }) {
        Button('上一页')
          .onClick(() => this.config.prevPage())

        Button('下一页')
          .onClick(() => this.config.nextPage())

        Button('跳转')
          .onClick(() => this.config.scrollToIndex(2))

        Button('添加图片')
          .onClick(() => {
            this.imageList.push('https://example.com/newimage.jpg')
            this.config.setIndicatorCount(this.imageList.length)
          })
      }
      .width('100%')
      .padding(10)

      Stack() {
        ImagePreviewSwiper({
          config: this.config,
          data: this,
          imagesBuilder: this.imageChild
        })
      }
      .width('100%')
      .height('80%')
    }
    .backgroundColor(Color.Pink)
    .width('100%')
    .height('100%')
  }
}